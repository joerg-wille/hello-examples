<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Paremus Service Fabric Hello Example</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">
    
    <script>
      repopulateResults = function(result, div) {
          while (div.firstChild) {
              div.removeChild(div.firstChild);
          }
                                  
          for(var i = 0, size = result.available.length; i < size ; i++) {
              var id = result.available[i];
              var child = document.createElement("div");
              div.appendChild(child);
              child.id = id;
              child.class = 'span3';
              if(result.messages[id]) {
                  child.textContent = result.messages[id];
              } else {
                  child.textContent = id + ' is available';
              }
          }
      };
      
      doUpdate = function() {
       
          var req = new XMLHttpRequest();
        
          req.onreadystatechange = function() {
                  if (req.readyState==4) {
                      var result = null;
                      var div = document.getElementById("results")

                      if (req.status==200) {
                          result = JSON.parse(req.responseText);
                          if(!result.available.length) {
                              result.available = ["foo"];
                              result.messages = {"foo": 'No greeting services are currently available'};
                          }
                      } else {
                          result = { "available": ["foo"], "messages": { "foo": 'An error occurred!'}};
                      }
                      
                      repopulateResults(result, div);
                  }
              };
        
          var path = '/hello/sayHello';
          var name = document.getElementById("name");
          
          if(name && name.value) {
              path = path + '?name=' + name.value;
          }
        
          req.open("GET", path);
          req.send();
      };
      
      doUpdate();
    </script>
  </head>
  
  <body>
    <div class="container-fluid">
    <div class="row">
      <div class="span4 logo">
        <img border="0" src="img/logo-paremus.png" alt="Paremus Ltd">
      </div>
      <div class="span4">
        <h4>Welcome to the Hello Example</h4>
      </div>
    </div>
    
    <div class="row">    
      <div class="span5">
        <form class="form-inline" role="form">
          <input id="name" type="text" placeholder="Enter your name"/> 
          <button type="submit" class="btn btn-primary" 
                  onclick="doUpdate(); return false;">Say Hello!</button>
        </form>
      </div>
    </div>
    
    <div class="row">    
      <div class="span9 lead text-center" id="results"/>
    </div>
  </body>
</html>